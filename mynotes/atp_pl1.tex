\labeledsection{Automated Theorem Proving in First-Order Logic}{sec:atp_pl1}
\definition{$\mathcal{T}_1$}{
The \textbf{Standard First-Order Tableau Calculus} extends \linkterm{$\mathcal{T}_0$}{t0_calculus} with the following \linkterm{inference rules}{inference_rules_logic}
\begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
    \begin{multicols}{2}
        \noindent
        \begin{minipage}{\linewidth}
            \[
                \infer[\mathcal{T}_1 \forall]{([C/X](A))^T}{(\forall X.A)^T \quad C \in \text{\linkterm{cwff}{wff_terms}}_{\iota}(\Sigma)}
            \]
        \end{minipage}
    
        \noindent
        \begin{minipage}{\linewidth}
            \[
                \infer[\mathcal{T}_1 \exists]{([c/X]A)^F}{(\forall X.A)^F \quad c \in \Sigma_0^{sk} \text{new}}
            \]
        \end{minipage}
    \end{multicols}
\end{tcolorbox}
}{T1_standard}

\commandnote{
\textbf{Problem: }The rule $\mathcal{T}_1 \forall$ displays a case of \textit{"don't know indeterminism"}: to find a \linkterm{refutation}{c_refutation} we have to guess a formula $C$ from the \linkterm{infinite}{set_cardinality} \linkterm{set}{def:set} $\text{cwff}_{\iota}(\Sigma)$. 

For \linkterm{proof}{proofs} \linkterm{search}{tree_search}, this means $\mathcal{T}_1 \forall$ is \linkterm{infinitely}{set_cardinality} branching in general
}

\definition{$\mathcal{T}^f_1$}{
The \textbf{Free Variable Tableau Calculus} extends \linkterm{$\mathcal{T}_0$}{t0_calculus} with the following \linkterm{inference rules}{inference_rules_logic}
\begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
    \begin{multicols}{2}
        \noindent
        \begin{minipage}{\linewidth}
            \vspace{0.3cm}
            \[
                \infer[\mathcal{T}^f_1 \forall]{([Y/X](A))^T}{(\forall X.A)^T \quad Y \text{new}}
            \]
        \end{minipage}
    
        \noindent
        \begin{minipage}{\linewidth}
            \[
                \infer[\mathcal{T}^f_1 \exists]{
                    ([f(X^1, \cdots, X^k)/X]A)^F
                }{
                    (\forall X.A)^F \quad \text{free}(\forall X.A) = \set{X^1, \cdots, X^k} \quad f \in \Sigma^{sk}_k \text{new}
                }
            \]
        \end{minipage}
    \end{multicols}
\end{tcolorbox}
and generalizes its cut rule $\mathcal{T}_0 \bot$ to:
\begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]    
        \noindent
        \begin{minipage}{\linewidth}
            \[
                \infer[\mathcal{T}_1^f \bot]{\bot : \sigma}{
                    \begin{array}{lll}
                        A^\alpha & & \\
                        \vdots &  & \\
                        B^\beta & \quad (\alpha \neq \beta) & \quad \sigma(A) = \sigma(B)
                    \end{array}
                }
            \]
        \end{minipage}
\end{tcolorbox}
$\mathcal{T}_1^f$ \textbf{instantiates} the \textbf{whole tableau} by $\sigma$
}{T1_free}

\definition{}{
\linkterm{Derivable rules}{derived_inference_rule} in \linkterm{$\mathcal{T}^f_1$}{T1_free}:
\begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
    \begin{multicols}{2}
        \noindent
        \begin{minipage}{\linewidth}
            \vspace{0.3cm}
            \[
                \infer{([Y/X](A))^F}{(\exists X.A)^F \quad Y \text{new}}
            \]
        \end{minipage}
    
        \noindent
        \begin{minipage}{\linewidth}
            \[
            \infer{([f(X^1,\cdots,X^k)/X](A))^T}{
                (\exists X.A)^T \quad
                free(\forall X.A) = \{X^1,\cdots,X^k\} \quad
                f \in \Sigma_{k}^{sk} \text{new}
            }
            \]
        \end{minipage}
    \end{multicols}
\end{tcolorbox}
}{T1_free_derived}

Combining \linkterm{$\mathcal{T}_0$}{t0_calculus} and \linkterm{$\mathcal{T}^f_1$}{T1_free} we get the \linkterm{inference rules}{inference_rules_logic} shown in \figref{fig:tableau_all}:

\begin{figure}[H]
\centering
\begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
\begin{multicols}{2}
    \noindent
    \begin{minipage}{\linewidth}
        \[
            \infer[\mathcal{T}_0 \land]{
                \begin{array}{c}
                    A^T \\
                    B^T
                \end{array}
            }{(A \land B)^T}
        \]
    \end{minipage}

    \noindent
    \begin{minipage}{\linewidth}
        \[
            \infer[\mathcal{T}_0 \lor]{A^F \mid B^F}{(A \land B)^F}
        \]
    \end{minipage}
\end{multicols}

\begin{multicols}{2}
    % Negation True Rule
    \noindent
    \begin{minipage}{\linewidth}
        \[
            \infer[\mathcal{T}_0 \neg^T]{A^F}{(\neg A)^T}
        \]
    \end{minipage}

    % Negation False Rule
    \noindent
    \begin{minipage}{\linewidth}
        \[
            \infer[\mathcal{T}_0 \neg^F]{A^T}{(\neg A)^F}
        \]
    \end{minipage}
\end{multicols}

% Contradiction Rule
\noindent
\begin{minipage}{\linewidth}
    \[
        \infer[\mathcal{T}_0 \bot]{\bot}{
            \begin{array}{ll}
                A^\alpha & \\
                \vdots & \\
                A^\beta & (\alpha \neq \beta)
            \end{array}
        }
    \]
\end{minipage}

\begin{multicols}{2}
    \noindent
    \begin{minipage}{\linewidth}
        %\vspace{0.3cm}
        \[
        \hspace{-2cm}
            \infer[\mathcal{T}^f_1 \forall]{([Y/X](A))^T}{(\forall X.A)^T \quad Y \text{new}}
        \]
    \end{minipage}

    \noindent
    \begin{minipage}{\linewidth}
        \[
        \hspace{-2cm}
            \infer[\mathcal{T}^f_1 \exists]{
                ([f(X^1, \cdots, X^k)/X]A)^F
            }{
                (\forall X.A)^F \quad \text{free}(\forall X.A) = \set{X^1, \cdots, X^k} \quad f \in \Sigma^{sk}_k \text{new}
            }
        \]
    \end{minipage}
\end{multicols}


\begin{minipage}{\linewidth}
    \[
        \infer[\mathcal{T}_1^f \bot]{\bot : \sigma}{
            \begin{array}{lll}
                A^\alpha & & \\
                \vdots &  & \\
                B^\beta & \quad (\alpha \neq \beta) & \quad \sigma(A) = \sigma(B)
            \end{array}
        }
    \]
\end{minipage}

\par\vspace{0.5em}
\noindent
\begin{tikzpicture}
    \draw[dashed] (0,0) -- (\linewidth,0);
\end{tikzpicture}
\par\vspace{0.5em}

\begin{multicols}{3}
    \noindent
    \begin{minipage}{\linewidth}
        \[
            \infer[]{A^F \mid B^T}{(A \Rightarrow B)^T}
        \]
    \end{minipage}

    \noindent
    \begin{minipage}{\linewidth}
        \[
            \infer[]{
                \begin{array}{c}
                    A^T \\
                    B^F
                \end{array}
            }{(A \Rightarrow B)^F}
        \]
    \end{minipage}

    \noindent
    \begin{minipage}{\linewidth}
        \vspace{-0.4cm}
        \[
            \infer[]{B^T}{
                \begin{array}{c}
                    A^T \\
                    (A \Rightarrow B)^T
                \end{array}
            }
        \]
    \end{minipage}
\end{multicols}

\begin{multicols}{2}
    \noindent
    \begin{minipage}{\linewidth}
        \[
            \infer[]{A^T \mid B^T}{(A \lor B)^T}
        \]
    \end{minipage}

    \noindent
    \begin{minipage}{\linewidth}
        \[
            \infer[]{
                \begin{array}{c}
                    A^F \\
                    B^F
                \end{array}
            }{(A \lor B)^F}
        \]
    \end{minipage}
\end{multicols}

\begin{multicols}{2}
    \noindent
    \begin{minipage}{\linewidth}
        \[
            \infer[]{
                \begin{array}{c} A^T \\ B^T \end{array}
                \mid
                \begin{array}{c} A^F \\ B^F \end{array}
            }{(A \iff B)^T}
        \]
    \end{minipage}

    \noindent
    \begin{minipage}{\linewidth}
        \[
            \infer[]{
                \begin{array}{c} A^T \\ B^F \end{array}
                \mid
                \begin{array}{c} A^F \\ B^T \end{array}
            }{(A \iff B)^F}
        \]
    \end{minipage}
\end{multicols}

\begin{multicols}{2}
    \noindent
    \begin{minipage}{\linewidth}
        %\vspace{0.3cm}
        \[
        \hspace{-2cm}
            \infer{([Y/X](A))^F}{(\exists X.A)^F \quad Y \text{new}}
        \]
    \end{minipage}

    \noindent
    \begin{minipage}{\linewidth}
        \[
        \hspace{-2cm}
        \infer{([f(X^1,\cdots,X^k)/X](A))^T}{
            (\exists X.A)^T \quad
            free(\forall X.A) = \{X^1,\cdots,X^k\} \quad
            f \in \Sigma_{k}^{sk} \text{new}
        }
        \]
    \end{minipage}
\end{multicols}
\end{tcolorbox}
\caption{\linkterm{$\mathcal{T}_0$}{t0_calculus} $\cup$ \linkterm{$\mathcal{T}^f_1$}{T1_free}}
\label{fig:tableau_all}
\end{figure}

\newpage
\textbf{Example Proof}

\begin{figure}[H]
    \centering
    \begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
        \centering
        \begin{tikzpicture}[node distance=1ex]
            \node (F) {$[(\forall X. P(X) \Rightarrow Q(X)) \Rightarrow ((\forall X. P(X)) \Rightarrow (\forall X. Q(X)))]^F$};
            \node (F1) [below=of F] {$[\forall X. P(X) \Rightarrow Q(X)]^T$};
            \node (F2) [below=of F1] {$((\forall X. P(X)) \Rightarrow (\forall X. Q(X)))^F$};
            \node (F3) [below=of F2] {$[\forall X. P(X)]^T$};
            \node (F4) [below=of F3] {$[\forall X. Q(X)]^F$};
            \node (F5) [below=of F4] {$[P(Y)]^T$};
            \node (F6) [below=of F5] {$[Q(c)]^F$};
            \node (F7) [below=of F6] {$[P(Z) \Rightarrow Q(Z)]^T$};
            
            %Branch
            \node (pOfZF) [below left=of F7] {$[P(Z)]^F$};
            \node (qOfZT) [below right=of F7] {$[Q(Z)]^T$};
            \node (close1) [below=of pOfZF] {$\bot : [Y / Z]$};
            \node (subst) [below=of qOfZT] {$[Q(Y)]^T$};
            \node (close2) [below=of subst] {$\bot : [c / Y]$};

            % Edges
            \path (F7) edge[-] (pOfZF);
            \path (F7) edge[-] (qOfZT);
        \end{tikzpicture}
    \end{tcolorbox}
    \caption{\linkterm{$\mathcal{T}^f_1$}{T1_free} Proof Example}
    \label{t1proofexample}
\end{figure}

All \linkterm{$\mathcal{T}^f_1$}{T1_free} \linkterm{rules}{inference_rules_logic} need to be applied once except for $\mathcal{T}^f_1 \forall$. The number of applications of $\mathcal{T}^f_1 \forall$ to $\forall X.A$  is called it's \refterm{multiplicity}{multiplicity_forall_rule}.

\Theorem{
\linkterm{$\mathcal{T}^f_1$}{T1_free} is only \linkterm{complete}{complete} with unbounded \linkterm{multiplicities}{multiplicity_forall_rule}
}{thm:t1_completeness}

\commandnote{
That is why \linkterm{validity}{valid_ls} in \linkterm{$\text{PL}^1$}{pl1} is undecidable
}

For example, see the \linkterm{proof}{proofs} in \figref{t1proof_multiplicity}:

\begin{figure}[H]
\centering
\begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
\centering
\begin{tikzpicture}[node distance=1.2ex]
    % Root expansion
    \node (F) {$[(P(a) \lor P(b)) \Rightarrow \exists X. P(X)]^F$};    
    \node (F1) [below=of F] {$[P(a) \lor P(b)]^T$};    
    \node (F2) [below=of F1] {$[\exists X. P(X)]^F$}; 
    
    % The node showing substitution progress
    \node (F3) [below=of F2] {$[P(Y)]^F$};
    \node (label1) [right=0.5cm of F3, color=red] {$\xrightarrow{[a/Y]} [P(a)]^F$};

    % The branching
    \draw (F3) -- ++(-1.5,-1) node(F4) [below] {$[P(a)]^T$};
    \draw (F3) -- ++(1.5,-1) node(F5) [below] {$[P(b)]^T$};

    % Left closure
    \node (close1) [below=of F4] {$\bot: [a/Y]$};
    
    % Right expansion and closure
    \node (subst) [below=2cm of F5] {$[P(Z)]^F$};
    \node (label2) [right=0.5cm of subst, color=blue] {$\xrightarrow{[b/Z]} [P(b)]^F$};
    \node (close2) [below=of subst] {$\bot : [b / Z]$};

    % Connect the second expansion visually
    \draw[->, bend left=40, color=blue, dashed] (F2.east) to node[midway, right, scale=0.8] {2nd application of $\mathcal{T}^f_1 \forall$} (subst.east);
    \draw (F5) -- (subst);

\end{tikzpicture}
\end{tcolorbox}
\caption{$\mathcal{T}^f_1 \forall$ Multiplicity Example}
\label{t1proof_multiplicity}
\end{figure}


\definition{Unification}{
For given \linkterm{terms}{terms_pl1} $A_1, A_2$, \textbf{unification} is the problem of finding a \linkterm{substitution}{substitution} $\sigma$ (called \textbf{unifier}), such that $\sigma(A_1)=\sigma(A_2)$
}{unification}

\definition{Unification Problem}{
We call a formula $A^1 =^? B^1 \land \cdots \land A^n =^? B^n$ a \textbf{unification problem} iff $A^i, B^i \in$ \linkterm{$\text{wff}_{\iota}(\Sigma_1, V_{\iota})$}{terms_pl1}
}{unification_problem}

\commandnote{
We consider \linkterm{unification problems}{unification_problem} as \linkterm{sets}{def:set} of equations. $\land$ here is associative, commutative, and idempotent.
We consider equations as two-\linkterm{element}{def:set} \linkterm{multisets}{multiset}, $=^?$ here is commutative
}

\definition{}{
A \linkterm{substitution}{substitution} is called a \textbf{unifier} for a \linkterm{unification problem}{unification_problem} $\mathcal{E}$ (and thus $\mathcal{E}$ is \textbf{unifiable}), iff it is a (simultaneous) unifier for all pairs in $\mathcal{E}$ 
}{unifier_unifiable}

\definition{}{
The solution for a \linkterm{unification problem}{unification_problem} $U(A_1, A_2)$ is the \linkterm{set}{def:set} of \linkterm{unifiers}{unifier_unifiable} $\set{\sigma \mid \sigma(A_1) = \sigma(A_2)}$. For example, let $\mathcal{E} := f(X) =^? f(g(Y))$, solutions are, e.g.
\begin{itemize}
\item $[g(a)/X], [a/Y]$
\item $[g(g(a))/X], [g(a)/Y]$
\item $[g(Z)/X], [Z/Y]$
\item $[g(Y)/X]$
\end{itemize}
}{unification_prob_sol}

\definition{}{
Let $\sigma$ and $\theta$ be \linkterm{substitutions}{substitution} and $W \subseteq \mathcal{V}_{\iota}$, we say that a \linkterm{substitution}{substitution} $\sigma$ is \textbf{more general} than $\theta$ on $W$ (write as $\sigma \leq \theta[W]$), iff there is a \linkterm{substitution}{substitution} $\rho$, such that $\theta = \rho \circ \sigma[W]$, where $\sigma = \rho[W]$, iff $\sigma(X) = \rho(X)$ for all $X \in W$
}{more_general_subst}

\begin{itemize}
    \item The substitution $\sigma = [g(Z)/X, Z/Y]$ is \linkterm{more general}{more_general_subst} than $\theta = [g(a)/X, a/Y]$ because there exists $\rho = [a/Z]$ such that:
    \[ \theta = \rho \circ \sigma \]
    This identity $\theta = \rho \circ \sigma$ is verified by applying the \linkterm{composition}{relation_composition} to the variables in the domain:
    \begin{itemize}
        \item $(\rho \circ \sigma)(X) = \rho(\sigma(X)) = \rho(g(Z)) = g(a)$
        \item $(\rho \circ \sigma)(Y) = \rho(\sigma(Y)) = \rho(Z) = a$
    \end{itemize}
    Since the mapping for each variable matches $\theta$, we confirm that $\theta$ is a specialization of $\sigma$ via $\rho$.

    \item Likewise, $\sigma$ is \linkterm{more general}{more_general_subst} than $\theta' = [g(g(a))/X, g(a)/Y]$ via $\rho' = [g(a)/Z]$, since:
    \[ \theta' = \rho' \circ \sigma \]
    where $(\rho' \circ \sigma)(X) = g(g(a))$ and $(\rho' \circ \sigma)(Y) = g(a)$.
\end{itemize}

\definition{MGU}{
$\sigma$ is called a \textbf{most general unifier (mgu)} of $A_1,A_2$, iff it is \linkterm{minimal}{least_element} in $U(A_1, A_2)$ \textbf{with respect to} the \linkterm{more general}{more_general_subst} ordering ($\leq$) restricted to the variables occurring in the problem: $W = \text{free}(A_1) \cup \text{free}(A_2)$. 
}{mgu}

\definition{}{
We call a pair $A =^? B$ \textbf{solved} in a \linkterm{unification problem}{unification_problem} $\mathcal{E}$, iff $A$ is a variable $X$, $\mathcal{E} = X =^? A \land \mathcal{E'}$, and $X \notin (\text{free}(A) \cup \text{free}(\mathcal{E'}))$. We call a \linkterm{unification problem}{unification_problem} $\mathcal{E}$ a \textbf{solved form}, iff all its pairs are \textbf{solved}.
}{solved_unif_prob}

\Lemma{
\linkterm{Solved forms}{solved_unif_prob} are of the form $X^1 =^? B^1 \land \cdots \land X^n =^? B^n$ where $X^i$ are distinct and $X^i \notin \text{free}(B^j)$
}{lemm:solved_forms}

\definition{$\mathcal{E}_{\sigma}$}{
Any \linkterm{substitution}{substitution} $\sigma = [B^1/X^1], \cdots , [B^n / X^n]$ induces a \textbf{solved unification problem} 
\[
\mathcal{E}_{\sigma} := (X^1 =^? B^1 \land \cdots \land X^n =^? B^n)
\]
}{solved_unification_problem}

\Lemma{
If $\mathcal{E} = X^1 =^? B^1 \land \cdots \land X^n =^? B^n$ is a \linkterm{solved form}{solved_unif_prob}, then $\mathcal{E}$ has the unique \linkterm{MGU}{mgu} $\sigma_{\epsilon} := [B^1 / X^1], \cdots , [B^n / X^n]$.
}{}

\definition{$\mathcal{U}$}{
The inference system $\mathcal{U}$ consists of the following \linkterm{inference rules}{inference_rules_logic}:
\begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
    \begin{multicols}{2}
        \noindent
        \begin{minipage}{\linewidth}
            \[
            \infer[\mathcal{U}_{dec}]
            {\mathcal{E} \land A^1 =^? B^1 \land \cdots \land A^n =^? B^n}
            {\mathcal{E} \land f(A^1,\cdots,A^n) =^? f(B^1,\cdots,B^n)}
            \]
        \end{minipage}
    
        \noindent
        \begin{minipage}{\linewidth}
            \vspace{0.1cm}
            \[
            \infer[\mathcal{U}_{triv}]
            {\mathcal{E}}
            {\mathcal{E} \land A =^? A}
            \]
        \end{minipage}
    \end{multicols}

    \begin{multicols}{2}
        \noindent
        \begin{minipage}{\linewidth}
            \[
                \infer[\mathcal{U}_{elim}]
                {[A/X](\mathcal{E} \land X =^? A)}
                {\mathcal{E} \land X =^? A \quad X \notin free(A) \quad X \in free(\mathcal{E})}
            \]
        \end{minipage}

        \noindent
        \begin{minipage}{\linewidth}
            \vspace{0.4cm}
            \[
                \infer[\mathcal{U} \bot]
                {\bot}
                {\mathcal{E} \land f(X^1,\cdots,X^n) =^? g(Y^1,\cdots,Y^n)}
            \]
        \end{minipage}
    \end{multicols}
\end{tcolorbox}
}{unification_calc}

\textbf{Unification Example : }Let $\mathcal{E} := f(g(X, X), h(a)) =^? f(g(a, Z), h(Z))$

\begin{figure}[H]
    \centering
    \begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
        \centering
        \vspace{0.3cm}
        \[
        \infer[\mathcal{U}_{triv}]
        {X =^? a \land Z =^? a}
        {
            \infer[\mathcal{U}_{elim}]
            {X =^? a \land Z =^? a \land a =^? a}
            {
                \infer[\mathcal{U}_{elim}]
                {X =^? a \land a =^? Z \land a =^? Z}
                {
                    \infer[\mathcal{U}_{dec}]
                    {X =^? a \land X =^? Z \land a =^? Z}
                    {
                        \infer[\mathcal{U}_{dec}]
                        {X =^? a \land X =^? Z \land h(a) =^? h(Z)}
                        {
                            \infer[\mathcal{U}_{dec}]
                            {g(X, X) =^? g(a, Z) \land h(a) =^? h(Z)}
                            {f(g(X, X), h(a)) =^? f(g(a, Z), h(Z))}
                        }
                    }
                }
            }
        }
        \]
        \vspace{0.1cm}
        The final $\mathcal{E}$ is in \linkterm{solved form}{solved_unif_prob} since all the pairs are \linkterm{solved}{solved_unif_prob}. Hence $\mathcal{E}$ has the unique \linkterm{MGU}{mgu} $\sigma_{\epsilon} := [a / X], [a / Z]$. 
    \end{tcolorbox}
\end{figure}

\textbf{Unification Example : }Let $\mathcal{E} := S_1(g(f(x), g(x, y)), y) =^? S_1(g(z, v), f(w))$

\begin{figure}[H]
    \centering
    \begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
        \centering
        \vspace{0.3cm}
        \[
        \infer[\mathcal{U}_{elim}]
        {z =^? f(x) \land v =^? g(x, f(w)) \land y =^? f(w)}
        {
            \infer[\mathcal{U}_{elim}]
            {z =^? f(x) \land v =^? g(x, y) \land y =^? f(w)}
            {
                \infer[\mathcal{U}_{dec}]
                {z =^? f(x) \land v =^? g(x, y) \land y =^? f(w)}
                {
                    \infer[\mathcal{U}_{dec}]
                    {g(f(x), g(x, y)) =^? g(z, v) \land y =^? f(w)}
                    {S_1(g(f(x), g(x, y)), y) =^? S_1(g(z, v), f(w))}
                }
            }
        }
        \]
        \vspace{0.4cm}
        \flushleft
        The final equation $z =^? f(x) \land v =^? g(x, f(w)) \land y =^? f(w)$ is in \linkterm{solved form}{solved_unif_prob}. \\
        The \linkterm{MGU}{mgu} is $\{z \to f(x), v \to g(x, f(w)), y \to f(w)\}$.
    \end{tcolorbox}
\end{figure}

\textbf{Unification Example : } Let $\mathcal{E}:=S_2(g(f(x), g(x, u)), f(y), z) =^? S_2(g(g(g(u, v), f(w)), f(c)), f(g(u, v)), f(c))$ (\linkterm{not unifiable}{unifier_unifiable})


\begin{figure}[H]
    \centering
    \begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
        \centering
        \[
        \infer[\mathcal{U} \bot]
        {\bot}
        {
            \infer[\mathcal{U}_{dec}]
            {f(x) =^? g(g(u, v), f(w)) \land g(x, u) =^? f(c) \land f(y) =^? f(g(u, v)) \land z =^? f(c)}
            {
                \infer[\mathcal{U}_{dec}]
                {g(f(x), g(x, u)) =^? g(g(g(u, v), f(w)), f(c)) \land f(y) =^? f(g(u, v)) \land z =^? f(c)}
                {S_2(g(f(x), g(x, u)), f(y), z) =^? S_2(g(g(g(u, v), f(w)), f(c)), f(g(u, v)), f(c))}
            }
        }
        \]
    \end{tcolorbox}
\end{figure}

\Lemma{
\linkterm{$\mathcal{U}$}{unification_calc} is \linkterm{sound}{sound}: $\mathcal{E} \vdash_{\mathcal{U}} \mathcal{F}$ implies $U(\mathcal{F}) \subseteq U(\mathcal{E})$
}{}

\Lemma{
\linkterm{$\mathcal{U}$}{unification_calc} is \linkterm{complete}{complete}: $\mathcal{E} \vdash_{\mathcal{U}} \mathcal{F}$ implies $U(\mathcal{E}) \subseteq U(\mathcal{F})$
}{}

\Lemma{
\linkterm{$\mathcal{U}$}{unification_calc} is confluent: the order of derivations does not matter
}{}

\Corollary{
First-Order \linkterm{unification}{unification} is unitary: i.e. \linkterm{MGUs}{mgu} are unique up to \linkterm{renaming}{alphabetical_variants} of \linkterm{introduced variables}{substitution_introduced} 
}{}

\Lemma{
\linkterm{$\mathcal{U}$}{unification_calc} is terminating; any \linkterm{$\mathcal{U}$}{unification_calc}-\linkterm{-derivation}{c_derivation} is \linkterm{finite}{set_cardinality}
}{}

\definition{}{
We call an equational problem $\mathcal{E}$ \linkterm{$\mathcal{U}$}{unification_calc}-\textbf{reducible}, iff there is a \linkterm{$\mathcal{U}$}{unification_calc}-step $\mathcal{E} \vdash_{\mathcal{U}} \mathcal{F}$ from $\mathcal{E}$
}{u_reducible}

\Lemma{
If $\mathcal{E}$ is \linkterm{unifiable}{unifier_unifiable} but not \linkterm{solved}{solved_unif_prob}, then it is \linkterm{$\mathcal{U}$-reducible}{u_reducible}
}{}

\Corollary{
First-Order \linkterm{unification}{unification} is decidable in \linkterm{$\text{PL}^1$}{pl1}
}{}

\textbf{Recall: }in \linkterm{$\mathcal{T}^f_1$}{T1_free}, the rule $\mathcal{T}^f_1 \bot$ instantiates the whole tableau. The problem is that there might be more than one $\mathcal{T}^f_1 \bot$ opportunity on a branch and choosing which one makes a difference. For example, in the following proof, if we choose to close first on the right branch, the tableau does not close! However, choosing the other $\mathcal{T}^f_1 \bot$ in the left branch allows closure!

\begin{figure}[H]
\centering
\begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
\centering
\begin{tikzpicture}[node distance=1.2ex]
    % Initial Formula
    \node (F0) {$(\exists X.(p(a) \wedge p(b) \Rightarrow p(X)) \wedge (q(b) \Rightarrow q(X)))^F$};
    
    % Gamma Expansion (Free Variable y)
    \node (F1) [below=of F0] {$((p(a) \wedge p(b) \Rightarrow p(Y)) \wedge (q(b) \Rightarrow q(Y)))^F$};
    
    % The Branching (Conjunction on F-side)
    \coordinate (Lpoint) at ([xshift=-2.5cm, yshift=-1.5cm]F1.south);
    \coordinate (Rpoint) at ([xshift=2.5cm, yshift=-1.5cm]F1.south);
    
    \draw (F1.south) -- (Lpoint);
    \draw (F1.south) -- (Rpoint);

    % Left Branch
    \node (L1) [below=0.1cm of Lpoint] {$(p(a) \wedge p(b) \Rightarrow p(Y))^F$};
    \node (L2) [below=of L1] {$p(a)^T$};
    \node (L3) [below=of L2] {$p(b)^T$};
    \node (L4) [below=of L3] {$p(Y)^F$};
    \node (Lclose) [below=of L4, color=blue] {$\bot: [a/Y]$};

    % Right Branch
    \node (R1) [below=0.1cm of Rpoint] {$(q(b) \Rightarrow q(Y))^F$};
    \node (R2) [below=of R1] {$q(b)^T$};
    \node (R3) [below=of R2] {$q(Y)^F$};

\end{tikzpicture}
\end{tcolorbox}
\end{figure}

Therefore, when implementing \linkterm{$\mathcal{T}^f_1$}{T1_free}, there are two ways of systematic search, namely \textbf{backtracking search} back over $\mathcal{T}^f_1 \bot$ opportunities and \linkterm{saturate}{saturated_tableau} without $\mathcal{T}^f_1 \bot$ and find \textbf{spanning matings}.

\definition{Spanning Mating}{
Let $\mathcal{T}$ be a \linkterm{$\mathcal{T}^f_1$}{T1_free} tableau, then we call a \linkterm{unification problem}{unification_problem} $\mathcal{E} := A_1 =? B_1 \cdots A_n =? B_n$ a \textbf{mating} for $\mathcal{T}$, iff $A_i^T$ and $B_i^F$ occur in the same branch in $\mathcal{T}$. We say taht $\mathcal{E}$ is a \textbf{spanning mating}, if $\mathcal{E}$ is \linkterm{unifiable}{unifier_unifiable} and every branch $\mathcal{B}$ of $\mathcal{T}$ contains $A_i^T$ and $B_i^F$ for some $i$.
}{spanning_mating}

\Theorem{
A \linkterm{$\mathcal{T}^f_1$}{T1_free}-tableau with \linkterm{spanning mating}{spanning_mating} induces a \linkterm{closed}{closed_tableau} \linkterm{$\mathcal{T}_1$}{T1_standard} tableau.
}{}

\definition{$\text{CNF}_1$}{
The \textbf{First-Order CNF Calculus} $\text{CNF}_1$ extends \linkterm{$\text{CNF}_0$}{cnf0_calculus} by the following \linkterm{rules}{inference_rules_logic}:
\begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
    \noindent
    \begin{minipage}{\linewidth}
        \[
            \infer[\forall^T]
            {([Z/X](A))^T \lor C}
            {(\forall X.A)^T \lor C \quad Z \notin (\text{free}(A) \cup \text{free}(C))}
        \]
    \end{minipage}
    
    \noindent
    \begin{minipage}{\linewidth}
        \vspace{1cm}
        \[
            \infer[\forall^F]
            {([f(X_1,\cdots,X_k)/X](A))^F \lor C}
            {(\forall X.A)^F \lor C \quad \text{free}(\forall X.A) = \{X_1,\cdots,X_k\} \quad
            f \in \sum_{k}^{sk} \text{new}}
        \]
    \end{minipage}
\end{tcolorbox}
}{cnf1_calculus}

\definition{}{
The following \linkterm{inference rules}{inference_rules_logic} are \linkterm{derived}{derived_inference_rule} in \linkterm{$\text{CNF}_1$}{cnf1_calculus}:
\begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
    \noindent
    \begin{minipage}{\linewidth}
        \[
            \infer[\exists^T]
            {([f(X_1,\cdots,X_k)/X](A))^T \lor C}
            {(\exists X.A)^T \lor C \quad \text{free}(\exists X.A) = \{X_1,\cdots,X_k\} \quad
            f \in \sum_{k}^{sk} \text{new}}
        \]
    \end{minipage}
    
    \noindent
    \begin{minipage}{\linewidth}
        \vspace{1cm}
        \[
            \infer[\exists^F]
            {([Z/X](A))^F \lor C}
            {(\exists X.A)^F \lor C \quad Z \notin (\text{free}(A) \cup \text{free}(C))}
        \]
    \end{minipage}
\end{tcolorbox}
}{cnf1_calculus_derived}

\definition{}{
\linkterm{$\text{CNF}_0$}{cnf0_calculus} $\cup$ \linkterm{$\text{CNF}_1$}{cnf1_calculus} \linkterm{rules}{inference_rules_logic} are shown in \figref{fig:cnf0_cnf1}
}{}

\begin{figure}[H]
    \centering
    \begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
        \begin{multicols}{2}
            \noindent
            \begin{minipage}{\linewidth}
                \[
                    \infer[\lor^T]
                    {C \lor A^T \lor B^T}
                    {C \lor (A \lor B)^T}
                \]
            \end{minipage}

            \noindent
            \begin{minipage}{\linewidth}
                \[
                    \infer[\lor^F]
                    {(C \lor A^F) \land (C \lor B^F)}
                    {C \lor (A \lor B)^F}
                \]
            \end{minipage}
        \end{multicols}

        \begin{multicols}{2}
            % Negation True Rule
            \noindent
            \begin{minipage}{\linewidth}
                \[
                    \infer[\neg^T]
                    {C \lor A^F}
                    {C \lor \neg A^T}
                \]
            \end{minipage}

            % Negation False Rule
            \noindent
            \begin{minipage}{\linewidth}
                \[
                    \infer[\neg^F]
                    {C \lor A^T}
                    {C \lor \neg A^F}
                \]
            \end{minipage}
        \end{multicols}

        \noindent
        \begin{minipage}{\linewidth}
            \[
                \infer[\forall^T]
                {([Z/X](A))^T \lor C}
                {(\forall X.A)^T \lor C \quad Z \notin (\text{free}(A) \cup \text{free}(C))}
            \]
        \end{minipage}
        
        \noindent
        \begin{minipage}{\linewidth}
            \vspace{0.5cm}
            \[
                \infer[\forall^F]
                {([f(X_1,\cdots,X_k)/X](A))^F \lor C}
                {(\forall X.A)^F \lor C \quad \text{free}(\forall X.A) = \{X_1,\cdots,X_k\} \quad
                f \in \sum_{k}^{sk} \text{new}}
            \]
        \end{minipage}

        \par\vspace{0.5cm}
        \noindent
        \begin{tikzpicture}
            \draw[dashed] (0,0) -- (\linewidth,0);
        \end{tikzpicture}

        \begin{multicols}{2}
            \noindent
            \begin{minipage}{\linewidth}
                \[
                    \infer[\Rightarrow^T]
                    {C \lor A^F \lor B^T}
                    {C \lor (A \Rightarrow B)^T}
                \]
            \end{minipage}

            \noindent
            \begin{minipage}{\linewidth}
                \[
                    \infer[\Rightarrow^F]
                    {(C \lor A^T) \land (C \lor B^F)}
                    {C \lor (A \Rightarrow B)^F}
                \]
            \end{minipage}
        \end{multicols}

        \begin{multicols}{2}
            \noindent
            \begin{minipage}{\linewidth}
                \[
                    \infer[\land^T]
                    {(C \lor A^T) \land (C \lor B^T)}
                    {C \lor (A \land B)^T}
                \]
            \end{minipage}

            \noindent
            \begin{minipage}{\linewidth}
                \[
                    \infer[\land^F]
                    {C \lor A^F \lor B^F}
                    {C \lor (A \land B)^F}
                \]
            \end{minipage}
        \end{multicols}

        \noindent
        \begin{minipage}{\linewidth}
            \vspace{0.5cm}
            \[
                \infer[\exists^T]
                {([f(X_1,\cdots,X_k)/X](A))^T \lor C}
                {(\exists X.A)^T \lor C \quad \text{free}(\exists X.A) = \{X_1,\cdots,X_k\} \quad
                f \in \sum_{k}^{sk} \text{new}}
            \]
        \end{minipage}
        
        \noindent
        \begin{minipage}{\linewidth}
            \vspace{0.5cm}
            \[
                \infer[\exists^F]
                {([Z/X](A))^F \lor C}
                {(\exists X.A)^F \lor C \quad Z \notin (\text{free}(A) \cup \text{free}(C))}
            \]
        \end{minipage}
    \end{tcolorbox}
    \caption{\linkterm{$\text{CNF}_0$}{cnf0_calculus} $\cup$ \linkterm{$\text{CNF}_1$}{cnf1_calculus}}
    \label{fig:cnf0_cnf1}
\end{figure}

\definition{$\mathcal{R}_1$}{
The \textbf{First-Order Resolution Calculus} $\mathcal{R}_1$ is a \linkterm{test calculus}{test_calculus} that manipulates \linkterm{formulae}{formulae_pl1} in \linkterm{CNF}{cnf}, therefore, it operates on \linkterm{clause sets}{clause_set}, and it has the following two \linkterm{inference rules}{inference_rules_logic}:
\begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
    \begin{multicols}{2}
        \noindent
        \begin{minipage}{\linewidth}
            \[
                \infer[\mathcal{R}_1]
                {(\sigma(C)) \lor (\sigma(D))}
                {A^T \lor C \quad B^F \lor D \quad \sigma = \text{\linkterm{MGU}{mgu}}(A,B)}
            \]
        \end{minipage}

        \noindent
        \begin{minipage}{\linewidth}
            \[
                \infer[\mathcal{R}_1]
                {(\sigma(A)) \lor (\sigma(C))}
                {A^{\alpha} \lor B^{\beta} \lor C \quad \sigma = \text{\linkterm{MGU}{mgu}}(A,B)}
            \]
        \end{minipage}
    \end{multicols}
\end{tcolorbox}
}{R1}

\definition{}{
\linkterm{$\mathcal{R}_0$}{R0} $\cup$ \linkterm{$\mathcal{R}_1$}{R1} \linkterm{inference rules}{inference_rules_logic} are shown in \figref{fig:r0_r1}
}{r0_r1}

\begin{figure}[H]
    \centering
    \begin{tcolorbox}[colback=white, colframe=black, sharp corners, boxrule=0.5pt]
        \noindent
        \begin{minipage}{\linewidth}
            \[
            \infer[\mathcal{R}_0]
            {A \lor B}
            {P^T \lor A \qquad \qquad P^F \lor B}
            \]
        \end{minipage}
        \begin{multicols}{2}
            \noindent
            \begin{minipage}{\linewidth}
                \[
                    \infer[\mathcal{R}_1]
                    {(\sigma(C)) \lor (\sigma(D))}
                    {A^T \lor C \quad B^F \lor D \quad \sigma = \text{\linkterm{MGU}{mgu}}(A,B)}
                \]
            \end{minipage}

            \noindent
            \begin{minipage}{\linewidth}
                \[
                    \infer[\mathcal{R}_1]
                    {(\sigma(A)) \lor (\sigma(C))}
                    {A^{\alpha} \lor B^{\beta} \lor C \quad \sigma = \text{\linkterm{MGU}{mgu}}(A,B)}
                \]
            \end{minipage}
        \end{multicols}
    \end{tcolorbox}
    \caption{\linkterm{$\mathcal{R}_0$}{R0} $\cup$ \linkterm{$\mathcal{R}_1$}{R1}}
    \label{fig:r0_r1}
\end{figure}

\textbf{Example 1:} We want to prove the following using \linkterm{$\mathcal{R}_1$}{R1}:
\[
\exists X. \forall Y. \exists Z. \exists W. ((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(Y) \land R(X,b)))
\]

We \linkterm{label}{labeled_formula} it with $F$ and use \linkterm{$\text{CNF}_1$}{cnf1_calculus}:
\[
[\exists X. \forall Y. \exists Z. \exists W. ((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(Y) \land R(X,b)))]^F
\]

We apply $\exists^F$ where
\[
X1 \notin \text{free}(\forall Y. \exists Z. \exists W. ((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(Y) \land R(X,b)))) = \set{X}
\]

We get:
\[
[\forall Y. \exists Z. \exists W. ((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(Y) \land R(X1,b)))]^F
\]

We apply $\forall^F$ where:
\[
\text{free}(\forall Y. \exists Z. \exists W. ((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(Y) \land R(X1,b)))) = \set{X1} \quad \abs{\set{X1}} = 1
\]
Hence, we invent a new $f(X1) \in \Sigma^{sk}_1$ and apply $[f(X1) / Y]$, we get:
\[
[\exists Z. \exists W. ((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(f(X1)) \land R(X1,b)))]^F
\]
We apply $\exists^F$ where:
\[
Z1 \notin \text{free}(\exists W. ((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(f(X1)) \land R(X1,b)))) = \set{Z,X1}
\]
We get:
\[
[\exists W. ((\neg P(Z1) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(f(X1)) \land R(X1,b)))]^F
\]
We apply $\exists^F$ where:
\[
W1 \notin \text{free}(((\neg P(Z1) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(f(X1)) \land R(X1,b)))) = \set{Z1, W, X1}
\]
We get:
\[
[((\neg P(Z1) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W1,a) \lor (P(f(X1)) \land R(X1,b)))]^F
\]
We apply $\lor^F$, we get:
\[
[\neg P(Z1) \land \neg R(b,a)]^F \land  [\neg R(a,b)]^F \land [R(W1,a)]^F \land [(P(f(X1)) \land R(X1,b))]^F
\]
We apply $\land^F$, we get:
\[
[\neg P(Z1)]^F \lor [\neg R(b,a)]^F \land  [\neg R(a,b)]^F \land [R(W1,a)]^F \land [P(f(X1))]^F \lor [R(X1,b)]^F
\]
We apply $\neg^F$:
\[
[P(Z1)]^T \lor [R(b,a)]^T \land  [R(a,b)]^T \land [R(W1,a)]^F \land [P(f(X1))]^F \lor [R(X1,b)]^F
\]
The final \linkterm{clause set}{clause_set} is:
\[
\set{[P(Z1)]^T \lor [R(b,a)]^T, [R(a,b)]^T, [R(W1,a)]^F, [P(f(X1))]^F \lor [R(X1,b)]^F}
\]

We start the \linkterm{$\mathcal{R}_1$}{R1}-\linkterm{refutation}{c_refutation}:

\begin{enumerate}
\item $[P(Z1)]^T \lor [R(b,a)]^T$
\item $[R(a,b)]^T$
\item $[R(W1,a)]^F$
\item $[P(f(X1))]^F \lor [R(X1,b)]^F$
\item Resolve $2$ with $4$ under $\sigma = [a/X1] \leadsto [P(f(a))]^F$
\item Resolve $1$ with $5$ under $\sigma = [a/Z1] \leadsto [R(b,a)]^T$
\item Resolve $3$ with $6$ under $\sigma = [b/W1] \leadsto \set{\square}$
\end{enumerate}

\minititle{A trick to make life easier}
When asked to prove something using \linkterm{$\mathcal{R}_1$}{R1}, we need first to transform to \linkterm{CNF}{cnf} using \linkterm{$\text{CNF}_1$}{cnf1_calculus}. Instead of applying the \linkterm{$\text{CNF}_1$}{cnf1_calculus} rules, we do the following steps:
\begin{enumerate}
    \item Negate the formula 
    \item Push negation inside
    \item Eliminate $\forall$ and $\exists$:
    \begin{itemize}
        \item If you are eliminating a $\forall$, leave the universally quantified variable as it is in the formula
        \item If you are eliminating a $\exists$, Skolemize:
        \begin{itemize}
            \item If before the $\exists$ there is a $\forall$, we Skolemize by new function $f \in \Sigma_k^{sk}$ whose parameters are the universally quantified variables before $\exists$
            \item If no $\forall$ is before the $\exists$, we Skolemize with a new constant $c \in \Sigma_0^{sk}$
        \end{itemize}
    \end{itemize}
\end{enumerate}

\textbf{Same Example} (now with the trick):
We want to prove the following using \linkterm{$\mathcal{R}_1$}{R1}:
\[
\exists X. \forall Y. \exists Z. \exists W. ((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(Y) \land R(X,b)))
\]

We negate the formula:
\[
\neg (\exists X. \forall Y. \exists Z. \exists W. ((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(Y) \land R(X,b))))
\]

We push negation inside:
\[
\forall X. \exists Y. \forall Z. \forall W. \neg((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(Y) \land R(X,b)))
\]

We eliminate $\forall W.$:
\[
\forall X. \exists Y. \forall Z. \neg((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(Y) \land R(X,b)))
\]

We eliminate $\forall Z.$:
\[
\forall X. \exists Y. \neg((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(Y) \land R(X,b)))
\]

We Skolemize $\exists Y.$:
\[
\forall X. \neg((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(f(X)) \land R(X,b)))
\]

We eliminate $\forall X.$
\[
\neg((\neg P(Z) \land \neg R(b,a)) \lor \neg R(a,b) \lor R(W,a) \lor (P(f(X)) \land R(X,b)))
\]
We continue by starting applying \linkterm{$\text{CNF}_0$}{cnf0_calculus} rules as above.

\textbf{Example 2:} We want to prove the following using \linkterm{$\mathcal{R}_1$}{R1}:
\[
\exists X.\forall Y.\exists W.\exists Z.\neg((R(Z,Y) \lor \neg P(Z))\land
(\neg Q(d) \lor P(c)) \land
(Q(d)\lor \neg P(c))\land
(\neg R(Z,Y) \lor \neg P(W) \lor \neg Q(X))\land
P(c)
)
\]

We negate:
\[
\neg (\exists X.\forall Y.\exists W.\exists Z.\neg((R(Z,Y) \lor \neg P(Z))\land
(\neg Q(d) \lor P(c)) \land
(Q(d)\lor \neg P(c))\land
(\neg R(Z,Y) \lor \neg P(W) \lor \neg Q(X))\land
P(c)
))
\]

We push negation inside:
\[
\forall X.\exists Y.\forall W.\forall Z.\neg \neg((R(Z,Y) \lor \neg P(Z))\land
(\neg Q(d) \lor P(c)) \land
(Q(d)\lor \neg P(c))\land
(\neg R(Z,Y) \lor \neg P(W) \lor \neg Q(X))\land
P(c)
)
\]

We eliminate $\forall Z.$
\[
\forall X.\exists Y.\forall W.\neg \neg((R(Z,Y) \lor \neg P(Z))\land
(\neg Q(d) \lor P(c)) \land
(Q(d)\lor \neg P(c))\land
(\neg R(Z,Y) \lor \neg P(W) \lor \neg Q(X))\land
P(c)
)
\]

We eliminate $\forall W.$
\[
\forall X.\exists Y.\neg \neg((R(Z,Y) \lor \neg P(Z))\land
(\neg Q(d) \lor P(c)) \land
(Q(d)\lor \neg P(c))\land
(\neg R(Z,Y) \lor \neg P(W) \lor \neg Q(X))\land
P(c)
)
\]

We Skolemize $\exists Y.$
\[
\forall X.\neg \neg((R(Z,f(X)) \lor \neg P(Z))\land
(\neg Q(d) \lor P(c)) \land
(Q(d)\lor \neg P(c))\land
(\neg R(Z,f(X)) \lor \neg P(W) \lor \neg Q(X))\land
P(c)
)
\]

We eliminate $\forall X.$
\[
\neg \neg((R(Z,f(X)) \lor \neg P(Z))\land
(\neg Q(d) \lor P(c)) \land
(Q(d)\lor \neg P(c))\land
(\neg R(Z,f(X)) \lor \neg P(W) \lor \neg Q(X))\land
P(c)
)
\]

This is just:
\[
[\neg((R(Z,f(X)) \lor \neg P(Z))\land
(\neg Q(d) \lor P(c)) \land
(Q(d)\lor \neg P(c))\land
(\neg R(Z,f(X)) \lor \neg P(W) \lor \neg Q(X))\land
P(c)
)]^F
\]

Using $\neg^F$
\[
[(R(Z,f(X)) \lor \neg P(Z))\land
(\neg Q(d) \lor P(c)) \land
(Q(d)\lor \neg P(c))\land
(\neg R(Z,f(X)) \lor \neg P(W) \lor \neg Q(X))\land
P(c)
]^T
\]
Using $\land^T$
\[
(R(Z,f(X)) \lor \neg P(Z))^T \land
(\neg Q(d) \lor P(c))^T \land
(Q(d)\lor \neg P(c))^T \land
(\neg R(Z,f(X)) \lor \neg P(W) \lor \neg Q(X))^T \land
(P(c))^T
\]

We are in \linkterm{CNF}{cnf}, we start the proof:

\begin{tabular}{|l|l|l|} \hline
1 & $(R(Z,f(X)))^T \lor (P(Z))^F$ & initial \\ \hline
2 & $(Q(d))^F \lor (P(c))^T$ & initial \\ \hline
3 & $(Q(d))^T \lor (P(c))^F$ & initial \\ \hline
4 & $(R(Z,f(X)))^F \lor (P(W))^F \lor (Q(X))^F$ & initial \\ \hline
5 & $(P(c))^T$ & initial \\ \hline
6 & $(Q(d))^T$ & 3, 5 \\ \hline
7 & $(R(c, f(X)))^T$ & 1, 5 $[c/Z]$ \\ \hline
8 & $(P(W))^F \lor (Q(X))^F$ & 4, 7 $[c/Z]$ \\ \hline
9 & $(Q(X))^F$ & 5, 8 $[c/W]$ \\ \hline
10 & $\square$ & 6, 9 $[d/X]$ \\ \hline
\end{tabular}

\textbf{Example 3: }Prove the following using \linkterm{$\mathcal{R}_1$}{R1}:
\[
\forall X \forall Y \forall Z \exists Z \exists U \exists V \exists W ((P(X,Y) \Rightarrow (P(Z,a)\Rightarrow R(a))) \Rightarrow ((P(U,V) \land P(W,a)) \Rightarrow R(a)))
\]

Negate:
\[
\neg (\forall X \forall Y \forall Z \exists Z \exists U \exists V \exists W ((P(X,Y) \Rightarrow (P(Z,a)\Rightarrow R(a))) \Rightarrow ((P(U,V) \land P(W,a)) \Rightarrow R(a))))
\]

Push negation inside:
\[
\exists X \exists Y \exists Z \forall Z \forall U \forall V \forall W \neg ((P(X,Y) \Rightarrow (P(Z,a)\Rightarrow R(a))) \Rightarrow ((P(U,V) \land P(W,a)) \Rightarrow R(a)))
\]

Eliminate $\forall Z \forall U \forall V \forall W$
\[
\exists X \exists Y \exists Z \neg((P(X,Y) \Rightarrow (P(Z,a)\Rightarrow R(a))) \Rightarrow ((P(U,V) \land P(W,a)) \Rightarrow R(a)))
\]

Skolemize:
\[
\neg((P(x,y) \Rightarrow (P(z,a)\Rightarrow R(a))) \Rightarrow ((P(U,V) \land P(W,a)) \Rightarrow R(a))) \quad x,y,z \in \Sigma_0^{sk}
\]

This is just:
\[
((P(x,y) \Rightarrow (P(z,a)\Rightarrow R(a))) \Rightarrow ((P(U,V) \land P(W,a)) \Rightarrow R(a)))^F
\]

Apply $\Rightarrow^F$
\[
(P(x,y) \Rightarrow (P(z,a)\Rightarrow R(a)))^T \land ((P(U,V) \land P(W,a)) \Rightarrow R(a))^F
\]

Apply $\Rightarrow^T$
\[
(P(x,y))^F \lor (P(z,a)\Rightarrow R(a))^T \land ((P(U,V) \land P(W,a)) \Rightarrow R(a))^F
\]

Apply $\Rightarrow^F$
\[
(P(x,y))^F \lor (P(z,a)\Rightarrow R(a))^T \land (P(U,V) \land P(W,a))^T \land (R(a))^F
\]

Apply $\land^T$
\[
(P(x,y))^F \lor (P(z,a)\Rightarrow R(a))^T \land (P(U,V))^T \land (P(W,a))^T \land (R(a))^F
\]

Apply $\Rightarrow^T$
\[
(P(x,y))^F \lor (P(z,a))^F \lor (R(a))^T \land (P(U,V))^T \land (P(W,a))^T \land (R(a))^F
\]

We are in \linkterm{CNF}{cnf}, we start the proof:

\begin{tabular}{|l|l|l|} \hline
1 & $(P(x,y))^F \lor (P(z,a))^F \lor (R(a))^T$ & initial \\ \hline
2 & $(P(U,V))^T$ & initial \\ \hline
3 & $(P(W,a))^T$ & initial \\ \hline
4 & $(R(a))^F$ & initial \\ \hline
5 & $(P(z,a))^F \lor (R(a))^T$ & 1,2 $[x/U],[y/V]$ \\ \hline
6 & $(R(a))^T$ & 3,5 $[z/W]$ \\ \hline
7 & $\square$ & 4,6 \\ \hline
\end{tabular}


\textbf{Example 4:} Let's just see an example where we need to convert to \linkterm{CNF}{cnf} (no \linkterm{proof}{proofs} required)
\[
\forall X. ((\forall Y. Q(Y) \Rightarrow P(X,Y)) \Rightarrow (\exists Y. P(Y,X)))
\]

First, we transform $(Q(Y) \Rightarrow P(X,Y))$ \hfill $A \Rightarrow B \leadsto \neg A \lor B$

\[
\forall X. ((\forall Y. \neg Q(Y) \lor P(X,Y)) \Rightarrow (\exists Y. P(Y,X)))
\]

Then we transform the outer implication:
\[
\forall X. (\neg (\forall Y. \neg Q(Y) \lor P(X,Y)) \lor (\exists Y. P(Y,X)))
\]

We push negation:
\[
\forall X. ((\exists Y. Q(Y) \land \neg P(X,Y)) \lor (\exists Y. P(Y,X)))
\]

Since we have two \textbf{different} $\exists Y$, we rename one to keep them distinct:
\[
\forall X. ((\exists Y. Q(Y) \land \neg P(X,Y)) \lor (\exists Z. P(Z,X)))
\]

We Skolemize $\exists Z$ and $\exists Y$:
\[
\forall X. ((Q(g(X)) \land \neg P(X,g(X))) \lor (P(f(X),X)))
\]

We eliminate the $\forall X$:
\[
(Q(g(X)) \land \neg P(X,g(X))) \lor (P(f(X),X))
\]

We distribute $\lor$ over $\land$

\[
(Q(g(X)) \lor P(f(X),X)) \land (\neg P(X,g(X)) \lor P(f(X),X))
\]

The final \linkterm{clause set}{clause_set} is: $\set{Q(g(X)) \lor P(f(X),X) , \neg P(X,g(X)) \lor P(f(X),X)}$

\definition{Horn Clause}{
A \textbf{Horn clause} is a \linkterm{clause}{clause_resolution} with \textbf{at most} one \textbf{positive} \linkterm{literal}{literal}
}{horn_clause}

\commandnote{
In Logic Programming Languages (e.g. PROLOG), \linkterm{$\text{PL}^1$}{pl1} \linkterm{Resolution}{R1} is the main machine behind the language. 

\textbf{Observations}:
\begin{itemize}
    \item A rule in PROLOG $H:-B_1, \cdots, B_n$ correspond to $H^T \lor B_1^F \cdots B_n^F$, i.e. a \linkterm{Horn clause}{horn_clause}
    \item A goal set (query) $?-G_1, \cdots, G_n$ corresponds to $G_1^F \cdots G_n^F$
    \item A fact $F$ corresponds to the \linkterm{unit clause}{clause_resolution} $F^T$
\end{itemize}
}

\definition{Horn Logic}{
Let $S := \langle \mathcal{L}, \mathcal{M}, \vDash \rangle$ be a \linkterm{logical system}{logical_system}. A \linkterm{formal system}{formal_system} $\langle S, \mathcal{C} \rangle$ is called a \textbf{Horn Logic} if:
\begin{itemize}
    \item The language $\mathcal{L}$ is the \linkterm{set}{def:set} of \linkterm{Horn clauses}{horn_clause}.
    \item The \linkterm{calculus}{calculus_logic} $\mathcal{H}$ is defined by the \linkterm{rules}{inference_rules_logic} of \linkterm{Modus Ponens}{hilbert_calculus} ($\text{MP}$), Conjunction Introduction ($\land I$), and \linkterm{Substitution}{hilbert_calculus} ($\text{Subst}$).
\end{itemize}
}{horn_logic}

\definition{Answer Substitution}{
A logic program (\linkterm{set}{def:set} of \linkterm{Horn clauses}{horn_clause}) $P$ \textbf{entails} a query $Q$ with \textbf{answer substitution} $\sigma$, iff there is an $\mathcal{H}$-\linkterm{derivation}{c_derivation} $D$ of $Q$ from $P$ and $\sigma$ is the combined \linkterm{substitution}{substitution} of the \linkterm{Subst}{hilbert_calculus} instances in $D$
}{answer_substitution_horn}

\textbf{Example:}
\begin{verbatim}
human(leibniz).
human(sokrates).
greek(sokrates).
fallible(X):-human(X).
\end{verbatim}
\textbf{Query: }?-fallible(X), greek(X).

We have three facts, one rule, and one query. They translate to the following \linkterm{clause set}{clause_set}:
\begin{enumerate}
    \item $\text{human(leibniz)}^T$
    \item $\text{human(sokrates)}^T$
    \item $\text{greek(sokrates)}^T$
    \item $\text{fallible}(X)^T \lor \text{human}(X)^F$ \hfill ($\text{human}(X) \Rightarrow \text{fallible}(X)$)
    \item $\text{fallible}(X)^F \lor \text{greek}(X)^F$ \hfill (Start Resolution)
    \item Resolve (1) with (4) under $[\text{leibniz} / X] \leadsto \text{fallible}(\text{leibniz})^T$
    \item Resolve (5) with (6) under $[\text{leibniz} / X] \leadsto \text{greek}(\text{leibniz})^F$
    \item $\text{greek}(\text{leibniz})^F$ cannot be resolved further; the program \linkterm{backtracks}{backtracking} to try another \linkterm{substitution}{substitution}.
    \item Resolve (2) with (4) under $[\text{sokrates} / X] \leadsto \text{fallible}(\text{sokrates})^T$
    \item Resolve (5) with (9) under $[\text{sokrates} / X] \leadsto \text{greek}(\text{sokrates})^F$
    \item Resolve (3) with (10) $\leadsto \{ \square \}$
    \item The program returns $T$ and the \linkterm{answer substitution}{answer_substitution_horn} $\sigma := [\text{sokrates} / X]$.
\end{enumerate}

\minititle{Forward and Backward Chaining:}
Other than querying (Backchaining), PROLOG derives facts given the set of facts initially written (Forward Chaining):

\textbf{Backchaining Example}:
\begin{verbatim}
has_motor(c).
has_wheels(c,4).
car(X) :- has_motor(X), has_wheels(X,4).
\end{verbatim}
\textbf{Query: }?-car(X).

We have two facts, one rule, and one query. They translate to the following \linkterm{clause set}{clause_set}:
\begin{enumerate}
    \item $\text{m}(c)^T$
    \item $\text{w}(c,4)^T$
    \item $\text{c}(X)^T \lor \text{m}(X)^F \lor \text{w}(X,4)^F$ \hfill ($\text{m}(X) \land \text{w}(X,4) \Rightarrow \text{c}(X)$)
    \item $\text{c}(X)^F$ \hfill (Start Resolution)
    \item Resolve (3) with (4) $\leadsto \text{m}(X)^F \lor \text{w}(X,4)^F$ 
    \item Resolve (5) with (1) under $[c / X] \leadsto \text{w}(c,4)^F$
    \item Resolve (6) with (2) $\leadsto \{ \square \}$
    \item The program returns $T$ and the \linkterm{answer substitution}{answer_substitution_horn} $\sigma := [c / X]$.
\end{enumerate}

\minititle{Forward Chaining Example:}
\begin{minipage}[t]{0.45\textwidth}
\begin{verbatim}
has_motor(c).
has_wheels(c,4).
car(X) :- has_motor(X), 
          has_wheels(X,4).
\end{verbatim}

We have two facts and one rule, which translate to:
\begin{enumerate}
    \item $m(c)^T$
    \item $w(c,4)^T$
    \item $m(X) \land w(X,4) \Rightarrow car(X)$
\end{enumerate}
\end{minipage}
\hfill
\begin{minipage}[t]{0.5\textwidth}
PROLOG can derive the fact $\text{car}(c)$ using the $\mathcal{H}$ \linkterm{calculus}{calculus_logic}:
\[
\infer[MP]{\text{car}(c)}{
    \infer[\land I]{m(c) \land w(c,4)}{
        \infer[Ax]{m(c)}{}
        &
        \infer[Ax]{w(c,4)}{}
    }
    &
    \infer[\text{Subst [c/X]}]{m(c) \land w(c,4) \Rightarrow car(c)}{
        \infer[Ax]{m(X) \land w(X,4) \Rightarrow car(X)}{}
    }
}
\]
\end{minipage}


